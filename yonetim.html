<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¶netici Paneli | BAKÄ° S2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --purple: #6c5ce7; }
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #110915; 
            color: #ffffff;
            min-height: 100vh;
            display: flex; 
        }
        .sidebar {
            background-color: #1a0e21; 
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.4);
            flex-shrink: 0;
            width: 250px;
        }
        .main-content {
            background-color: #110915;
            flex-grow: 1;
        }
        .admin-card {
            background-color: #1a0e21;
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 0.75rem; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); 
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            text-decoration: none;
            color: #e5e7eb;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .nav-item.active {
            background-color: var(--purple);
            color: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 8px rgba(108, 92, 231, 0.5);
        }
        .nav-item:hover:not(.active) {
            background-color: rgba(108, 92, 231, 0.1);
            border-radius: 0.5rem;
        }
        #loadingOverlay {
            background-color: #110915; 
            z-index: 1000; 
            display: flex; 
        }
    </style>
</head>
<body class="flex">

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
            const adminPanelWrapper = document.getElementById('adminPanelWrapper');
            if (adminPanelWrapper) {
                adminPanelWrapper.classList.remove('hidden');
            }
        });
    </script>
    
    <div id="loadingOverlay" class="fixed inset-0 flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500 mb-4"></div>
        <p id="loadingMessage" class="text-lg text-white text-center">YÃ¶netici Paneli yÃ¼kleniyor...</p>
    </div>

    <div id="adminPanelWrapper" class="hidden w-full flex">
        
        <div class="sidebar h-screen p-4 flex flex-col">
            <div class="text-3xl font-extrabold text-white mb-8 text-center">
                <i class="fas fa-screwdriver-wrench text-purple-500 mr-1"></i> ADMIN
            </div>

            <nav class="flex-grow space-y-2">
                <a href="#" class="nav-item active flex items-center p-3 text-white font-semibold transition duration-200" data-content="dashboard">
                    <i class="fas fa-chart-line w-6 mr-3"></i> YÃ¶netim Panosu
                </a>
                <a href="#" class="nav-item flex items-center p-3 text-gray-300 hover:text-white transition duration-200" data-content="users">
                    <i class="fas fa-users w-6 mr-3"></i> KullanÄ±cÄ± YÃ¶netimi
                </a>
                <a href="#" class="nav-item flex items-center p-3 text-gray-300 hover:text-white transition duration-200" data-content="links">
                    <i class="fas fa-link w-6 mr-3"></i> Link YÃ¶netimi
                </a>
                <a href="#" class="nav-item flex items-center p-3 text-gray-300 hover:text-white transition duration-200" data-content="settings">
                    <i class="fas fa-cogs w-6 mr-3"></i> Sistem AyarlarÄ±
                </a>
            </nav>

            <div class="mt-auto pt-4 border-t border-gray-700">
                <button id="adminLogoutButton" style="display: none;" class="w-full flex items-center justify-center p-3 text-red-400 bg-gray-700 rounded-lg font-semibold hover:bg-red-800 hover:text-white transition duration-200">
                    <i class="fas fa-sign-out-alt mr-3"></i> Ã‡Ä±kÄ±ÅŸ Yap
                </button>
            </div>
        </div>

        <div class="main-content p-8 overflow-y-auto">
            <header class="mb-8 pb-4 border-b border-gray-700">
                <h1 id="pageTitle" class="text-4xl font-extrabold text-white">YÃ¶netim Panosu</h1>
                <p class="text-gray-400">Sistem verilerine hÄ±zlÄ± genel bakÄ±ÅŸ.</p>
            </header>

            <div id="dashboardContent" class="content-tab">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="admin-card p-6">
                        <i class="fas fa-users text-purple-400 text-3xl mb-3"></i>
                        <h4 class="text-2xl font-bold text-white" id="totalUsers">YÃ¼kleniyor...</h4>
                        <p class="text-gray-400">Toplam KullanÄ±cÄ± SayÄ±sÄ±</p>
                    </div>
                    <div class="admin-card p-6">
                        <i class="fas fa-link text-yellow-400 text-3xl mb-3"></i>
                        <h4 class="text-2xl font-bold text-white" id="totalLinks">YÃ¼kleniyor...</h4>
                        <p class="text-gray-400">OluÅŸturulan Toplam Link</p>
                    </div>
                    <div class="admin-card p-6">
                        <i class="fas fa-check-circle text-green-400 text-3xl mb-3"></i>
                        <h4 class="text-2xl font-bold text-white" id="premiumUsers">YÃ¼kleniyor...</h4>
                        <p class="text-gray-400">Aktif Premium Abonelik</p>
                    </div>
                </div>

                <div class="admin-card p-6 mt-8">
                    <h3 class="text-xl font-bold text-white mb-4">Sistem Durumu (AnlÄ±k)</h3>
                    <p class="text-gray-400">Link yÃ¶nlendirme performansÄ± son 24 saat iÃ§inde stabil.</p>
                </div>
            </div>
            
            <div id="usersContent" class="content-tab hidden">
                <h3 class="text-2xl font-bold text-white mb-4">KullanÄ±cÄ± YÃ¶netimi <i class="fas fa-user-shield ml-2 text-purple-400"></i></h3>
                <p class="text-gray-300 mb-6">KullanÄ±cÄ±larÄ± arayÄ±n, durumlarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin ve moderasyon iÅŸlemlerini gerÃ§ekleÅŸtirin.</p>

                <div class="admin-card p-6 mb-6">
                    <h4 class="text-xl font-bold mb-3">ğŸ” KullanÄ±cÄ± Arama</h4>
                    <div class="flex space-x-3">
                        <input type="email" id="userSearchEmail" placeholder="KullanÄ±cÄ± E-posta Adresi..." class="flex-grow p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-purple-500 focus:border-purple-500 text-white">
                        <button id="searchUserButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-5 rounded-lg transition duration-200">
                            Ara
                        </button>
                    </div>
                    <div id="userSearchResult" class="mt-4 text-gray-300">Arama sonuÃ§larÄ± burada gÃ¶sterilecek.</div>
                </div>

                <div class="admin-card p-6">
                    <h4 class="text-xl font-bold mb-3">ğŸ“ Moderasyon Eylemleri</h4>
                    <p class="text-yellow-400 mb-4"><i class="fas fa-exclamation-triangle mr-2"></i> **NOT:** Bu iÅŸlevler iÃ§in Firebase Admin SDK veya Cloud Functions gereklidir.</p>
                    <div class="grid grid-cols-2 gap-4">
                        <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-ban mr-2"></i> HesabÄ± AskÄ±ya Al
                        </button>
                        <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            <i class="fas fa-crown mr-2"></i> Admin Yetkisi Ver
                        </button>
                    </div>
                </div>
            </div>

            <div id="linksContent" class="content-tab hidden">
                <h3 class="text-2xl font-bold text-white mb-4">Link YÃ¶netimi <i class="fas fa-clipboard-list ml-2 text-yellow-400"></i></h3>
                <p class="text-gray-300 mb-6">Sistemdeki linkleri denetleyin ve potansiyel olarak zararlÄ±/istenmeyen iÃ§erikleri yÃ¶netin.</p>

                <div class="admin-card p-6 mb-6">
                    <h4 class="text-xl font-bold mb-3">ğŸ”— En Son OluÅŸturulan Linkler</h4>
                    <div id="latestLinksList" class="space-y-3">
                        <p class="text-gray-400">Veriler yÃ¼kleniyor...</p>
                        <div class="flex justify-between items-center p-3 bg-gray-700 rounded-lg">
                            <span class="text-sm">kisa.link/abcde</span>
                            <button class="text-red-400 hover:text-red-500 text-sm font-semibold">Sil</button>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-700 rounded-lg">
                            <span class="text-sm">kisa.link/fghij</span>
                            <button class="text-red-400 hover:text-red-500 text-sm font-semibold">Sil</button>
                        </div>
                    </div>
                </div>

                <div class="admin-card p-6">
                    <h4 class="text-xl font-bold mb-3">ğŸš¨ Rapor Edilen Linkler</h4>
                    <p class="text-gray-400">Åu anda incelenmeyi bekleyen **0** rapor bulunmaktadÄ±r.</p>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-5 rounded-lg mt-4 transition duration-200">
                        RaporlarÄ± GÃ¶rÃ¼ntÃ¼le (VarsayÄ±msal)
                    </button>
                </div>
            </div>

            <div id="settingsContent" class="content-tab hidden">
                <h3 class="text-2xl font-bold text-white mb-4">Sistem AyarlarÄ± <i class="fas fa-server ml-2 text-green-400"></i></h3>
                <p class="text-gray-300 mb-6">UygulamanÄ±n genel ayarlarÄ±nÄ± ve bakÄ±m modunu yÃ¶netin.</p>

                <div class="admin-card p-6 mb-6">
                    <h4 class="text-xl font-bold mb-3">ğŸ‘· BakÄ±m Modu</h4>
                    <p class="text-gray-400 mb-3">TÃ¼m kullanÄ±cÄ± giriÅŸlerini ve link oluÅŸturmayÄ± geÃ§ici olarak durdurur.</p>
                    <button id="maintenanceModeToggle" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-5 rounded-lg transition duration-200">
                        <i class="fas fa-toggle-off mr-2"></i> BakÄ±m Modunu AÃ§
                    </button>
                    <p id="maintenanceStatus" class="mt-3 text-sm text-green-400 hidden"><i class="fas fa-check-circle mr-1"></i> Sistem bakÄ±m modundadÄ±r.</p>
                </div>

                <div class="admin-card p-6">
                    <h4 class="text-xl font-bold mb-3">ğŸ“£ Genel Duyuru AyarlarÄ±</h4>
                    <textarea id="announcementText" rows="3" placeholder="TÃ¼m kullanÄ±cÄ±lara gÃ¶sterilecek duyuru metnini buraya yazÄ±n..." class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-purple-500 focus:border-purple-500 text-white"></textarea>
                    <button id="saveAnnouncementButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-5 rounded-lg mt-3 transition duration-200">
                        Duyuruyu YayÄ±nla
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firebase Config ve BaÅŸlatma
        const firebaseConfig = {
            apiKey: "AIzaSyBfc0F8o5aVmwTw-gyLRZVI2OMUljFi6Ao",
            authDomain: "baki-s2-yonetim.firebaseapp.com",
            projectId: "baki-s2-yonetim",
            storageBucket: "baki-s2-yonetim.firebasestorage.app",
            messagingSenderId: "692508919425",
            appId: "1:692508919425:web:fac963c81c11b7be70af80",
            measurementId: "G-Q52XG8GLB2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // HTML Elementleri
        const loadingMessage = document.getElementById('loadingMessage');
        const adminLogoutButton = document.getElementById('adminLogoutButton');
        const navItems = document.querySelectorAll('.nav-item');
        const contentTabs = document.querySelectorAll('.content-tab');
        const pageTitle = document.getElementById('pageTitle');

        // YENÄ° ELEMANLAR
        const searchUserButton = document.getElementById('searchUserButton');
        const userSearchEmail = document.getElementById('userSearchEmail');
        const userSearchResult = document.getElementById('userSearchResult');
        const maintenanceModeToggle = document.getElementById('maintenanceModeToggle');
        const maintenanceStatus = document.getElementById('maintenanceStatus');
        const latestLinksList = document.getElementById('latestLinksList');
        
        // --- KullanÄ±cÄ± ArayÃ¼zÃ¼ GÃ¼ncellemesi (Firebase durumuna gÃ¶re) ---
        function updateAdminUI(user) {
            if (user) {
                adminLogoutButton.style.display = 'flex'; 
                loadingMessage.textContent = `Oturum aÃ§Ä±k: ${user.email}. Veriler yÃ¼kleniyor...`;
            } else {
                adminLogoutButton.style.display = 'none';
                loadingMessage.textContent = 'GiriÅŸ yapÄ±lmadan eriÅŸildi. Sadece admin bilir.';
            }
        }

        // --- Veri Ã‡ekme Fonksiyonu (YÃ¶netim Panosu) ---
        async function loadDashboardData() {
            try {
                // Toplam KullanÄ±cÄ± SayÄ±sÄ±
                const usersSnapshot = await getDocs(collection(db, "users"));
                document.getElementById('totalUsers').textContent = usersSnapshot.size.toLocaleString('tr-TR');

                // Toplam Link SayÄ±sÄ± (Maksimum 50 link Ã§eker)
                const linksSnapshot = await getDocs(collection(db, "links"));
                document.getElementById('totalLinks').textContent = linksSnapshot.size.toLocaleString('tr-TR');

                // Aktif Premium KullanÄ±cÄ± SayÄ±sÄ±
                const premiumQuery = query(collection(db, "users"), where("accountType", "==", "PREMIUM"));
                const premiumSnapshot = await getDocs(premiumQuery);
                document.getElementById('premiumUsers').textContent = premiumSnapshot.size.toLocaleString('tr-TR');

            } catch (e) {
                console.error("YÃ¶netim verileri yÃ¼klenirken hata:", e);
                document.getElementById('totalUsers').textContent = 'HATA (Ä°zin Yok)';
                document.getElementById('totalLinks').textContent = 'HATA (Ä°zin Yok)';
                document.getElementById('premiumUsers').textContent = 'HATA (Ä°zin Yok)';
            }
        }
        
        // --- YENÄ° Ã–ZELLÄ°K: KullanÄ±cÄ± Arama Ä°ÅŸlevi (Client-side) ---
        searchUserButton.addEventListener('click', async () => {
            const email = userSearchEmail.value.trim();
            userSearchResult.innerHTML = 'KullanÄ±cÄ± aranÄ±yor...';

            if (!email) {
                userSearchResult.innerHTML = '<span class="text-red-400">LÃ¼tfen bir e-posta adresi girin.</span>';
                return;
            }

            try {
                // Firebase Auth'tan kullanÄ±cÄ±nÄ±n varlÄ±ÄŸÄ±nÄ± kontrol et
                const methods = await fetchSignInMethodsForEmail(auth, email);

                if (methods && methods.length > 0) {
                    // KullanÄ±cÄ± Firestore'dan Ã§ekilir (Firestore'da 'users' koleksiyonu olmalÄ±dÄ±r)
                    const userQuery = query(collection(db, "users"), where("email", "==", email));
                    const userSnap = await getDocs(userQuery);

                    if (!userSnap.empty) {
                        const userData = userSnap.docs[0].data();
                        userSearchResult.innerHTML = `
                            <div class="mt-4 p-4 border border-green-500 rounded-lg bg-gray-800">
                                <h5 class="font-bold text-green-400">KullanÄ±cÄ± Bulundu: ${email}</h5>
                                <p>Hesap Tipi: <span class="font-semibold">${userData.accountType || 'TEMEL'}</span></p>
                                <p>KayÄ±t Tarihi: ${userData.createdAt ? new Date(userData.createdAt.seconds * 1000).toLocaleDateString() : 'Bilinmiyor'}</p>
                                <p class="text-yellow-400">UID: ${userSnap.docs[0].id}</p>
                            </div>
                        `;
                    } else {
                        userSearchResult.innerHTML = `<span class="text-yellow-400">E-posta Auth'da var, ancak Firestore'da 'users' kaydÄ± bulunamadÄ±.</span>`;
                    }
                } else {
                    userSearchResult.innerHTML = `<span class="text-red-400">Bu e-posta adresine kayÄ±tlÄ± bir kullanÄ±cÄ± bulunamadÄ±.</span>`;
                }

            } catch (error) {
                console.error("KullanÄ±cÄ± arama hatasÄ±:", error);
                userSearchResult.innerHTML = `<span class="text-red-400">Hata oluÅŸtu: ${error.message}</span>`;
            }
        });

        // --- YENÄ° Ã–ZELLÄ°K: BakÄ±m Modu Ä°ÅŸlevi (Sadece ArayÃ¼z Ã–rneÄŸi) ---
        maintenanceModeToggle.addEventListener('click', () => {
            const isActive = maintenanceModeToggle.classList.contains('bg-red-600');
            
            if (isActive) {
                // Kapat
                maintenanceModeToggle.classList.remove('bg-red-600', 'hover:bg-red-700');
                maintenanceModeToggle.classList.add('bg-gray-500', 'hover:bg-gray-600');
                maintenanceModeToggle.innerHTML = '<i class="fas fa-toggle-off mr-2"></i> BakÄ±m Modunu AÃ§';
                maintenanceStatus.classList.add('hidden');
            } else {
                // AÃ§
                maintenanceModeToggle.classList.remove('bg-gray-500', 'hover:bg-gray-600');
                maintenanceModeToggle.classList.add('bg-red-600', 'hover:bg-red-700');
                maintenanceModeToggle.innerHTML = '<i class="fas fa-toggle-on mr-2"></i> BakÄ±m Modunu Kapat';
                maintenanceStatus.classList.remove('hidden');
                maintenanceStatus.textContent = 'UYARI: Sistem bakÄ±m modunda. CanlÄ±ya almanÄ±z gerekebilir.';
                maintenanceStatus.classList.remove('text-green-400');
                maintenanceStatus.classList.add('text-red-400');

            }

            // GerÃ§ek bakÄ±m modu iÅŸlemi iÃ§in Firestore'da bir ayar belgesini gÃ¼ncellemeniz gerekir.
        });


        // --- Sayfa GeÃ§iÅŸleri (Tab Switching) ---
        const switchTab = (targetContentId) => {
            contentTabs.forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`${targetContentId}Content`).classList.remove('hidden');
            
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-content') === targetContentId) {
                    item.classList.add('active');
                }
            });
            
            const titleMap = {
                'dashboard': 'YÃ¶netim Panosu',
                'users': 'KullanÄ±cÄ± YÃ¶netimi',
                'links': 'Link YÃ¶netimi',
                'settings': 'Sistem AyarlarÄ±'
            };
            pageTitle.textContent = titleMap[targetContentId] || 'YÃ¶netim Paneli';
        };

        // --- Olay Dinleyicileri ---
        adminLogoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                window.location.reload(); 
            } catch (error) {
                console.error("Ã‡Ä±kÄ±ÅŸ hatasÄ±:", error);
                alert("Ã‡Ä±kÄ±ÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu.");
            }
           
        });

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                switchTab(item.getAttribute('data-content'));
            });
        });

        // --- BaÅŸlatma ---
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('dashboard'); 

            // Firebase durumunu dinle
            onAuthStateChanged(auth, (user) => {
                updateAdminUI(user);
            });
           
            loadDashboardData(); 
        });

    </script>
</body>
</html>
