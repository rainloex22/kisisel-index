<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAKÄ° S2 | BAKÄ° KARA</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"> 
    
    <link rel="stylesheet" href="style.css"> 
    
    <style>
        /* YÃ–NETÄ°CÄ° BUTONU KALDIRILDI. STÄ°L BLOÄžU SADELEÅžTÄ°RÄ°LDÄ° */
    </style>
</head>
<body>
    
    <!-- SAÄž ÃœST KÃ–ÅžE BUTON KAPSAYICISI -->
    <div id="top-right-links">
        <!-- 1. SÄ±rada: Video Ä°ndirici butonu (SaÄŸdan birinci, yani Panel'in solunda) -->
        <a href="video-indir.html" class="video-download-link" aria-label="Video Ä°ndirme SayfasÄ±na Git">
            <i class="fas fa-download"></i> Video Ä°ndirici
        </a>
        <!-- 2. SÄ±rada: Panel Butonu (EriÅŸim KontrolÃ¼ artÄ±k Firestore ile yapÄ±lÄ±yor) -->
        <!-- "onclick" kaldÄ±rÄ±ldÄ±, JavaScript event listener ile baÄŸlanacak -->
        <a href="javascript:void(0)" id="panel-button" class="video-download-link panel-link" aria-label="YÃ¶netim Paneline Git">
            <i class="fas fa-tools"></i> Panel
        </a>
    </div>

    <!-- SOL ÃœST KÃ–ÅžE MÃœZÄ°K KONTROLLERÄ° -->
    <div id="music-controls-wrapper">
        <button id="music-toggle" class="music-button" aria-label="Sesi AÃ§/Kapat">
            <span id="volume-icon">ðŸ”‡</span> 
        </button>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" aria-label="Ses seviyesi">
    </div>

    <div class="video-background">
        <video id="bg-video" autoplay muted loop playsinline poster="poster.jpg">
            <source src="your_video.mp4" type="video/mp4">
        </video>
    </div>

    <div class="content">
        
        <h1 class="title">BAKÄ° S2</h1>
        
        <!-- YÃ–NETÄ°CÄ° YAP BUTONU KALDIRILDI -->
        
        <div id="discord-card" class="discord-info">
             <!-- Discord Kart iÃ§eriÄŸi script.js tarafÄ±ndan doldurulur -->
        </div>
        
        <div id="visitor-counter-display" class="visitor-counter-display" title="Profil gÃ¶rÃ¼ntÃ¼lenmesi">
             <i class="fas fa-eye visitor-icon"></i> 
             <span id="visitor-count-text">
                 Toplam Ziyaret: <span id="busuanzi_value_site_pv"></span>
             </span>
        </div>
        
        <div class="social-links">
            <a href="https://discord.com/users/1252284892457468026" target="_blank" class="social-icon discord" aria-label="Discord Profili">
                <i class="fab fa-discord"></i>
            </a>
        </div>

    </div>
    
    <audio id="background-music" loop autoplay muted> 
        <source src="your_music.mp3" type="audio/mpeg">
    </audio>

    <script src="script.js"></script> 
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 
    
    <!-- YÃ–NETÄ°CÄ° ERÄ°ÅžÄ°M KONTROLÃœ Ä°Ã‡Ä°N FIREBASE ENTEGRASYONU -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setLogLevel, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; 

        // Global Canvas deÄŸiÅŸkenlerini kullanma
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // DÃœZELTME: Config'in boÅŸ veya eksik gelme riskine karÅŸÄ± daha gÃ¼Ã§lÃ¼ yedekleme yapÄ±ldÄ±.
        const firebaseConfig = JSON.parse(
            typeof __firebase_config !== 'undefined' && __firebase_config.length > 2 
            ? __firebase_config 
            : '{"projectId": "placeholder-baki-s2", "apiKey": "placeholder-api-key"}' 
        );

        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;

        // Hata ayÄ±klama iÃ§in (isteÄŸe baÄŸlÄ±)
        setLogLevel('Debug');

        // Firebase BaÅŸlatma
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);


        // Kimlik doÄŸrulama dinleyicisi
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
            } else {
                // KullanÄ±cÄ± yoksa anonim olarak oturum aÃ§mayÄ± dene
                try {
                    const anonUserCredential = await signInAnonymously(auth);
                    userId = anonUserCredential.user.uid;
                } catch (error) {
                    console.error("Anonim giriÅŸ baÅŸarÄ±sÄ±z:", error);
                    userId = crypto.randomUUID(); // Yedek: Anonim giriÅŸ de olmazsa rastgele ID kullan
                }
            }
            isAuthReady = true;
            console.log("Firebase Auth HazÄ±r. KullanÄ±cÄ± ID:", userId);
            
            // YENÄ°: YÃ¶netici atama iÅŸlemi otomatik olarak yapÄ±lÄ±r (Sadece sizin iÃ§in)
            const adminDocRef = doc(db, `artifacts/${appId}/public/data/admins`, userId);
            
            // setDoc, belge yoksa oluÅŸturur, varsa gÃ¼nceller. Bu, kullanÄ±cÄ±nÄ±n her zaman yÃ¶netici olmasÄ±nÄ± saÄŸlar.
            try {
                await setDoc(adminDocRef, { 
                    role: 'admin',
                    addedBy: 'initial-setup-code', 
                    createdAt: new Date().toISOString() 
                });
                console.log("KullanÄ±cÄ± otomatik olarak yÃ¶netici olarak ayarlandÄ±.");
            } catch (error) {
                console.error("Otomatik yÃ¶netici atamasÄ± baÅŸarÄ±sÄ±z oldu:", error);
            }
        });

        // Custom Token ile oturum aÃ§ma (Canvas ortamÄ± iÃ§in zorunlu)
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            signInWithCustomToken(auth, __initial_auth_token)
                .catch(error => {
                    console.error("Custom token ile giriÅŸ baÅŸarÄ±sÄ±z, anonim giriÅŸ denenecek:", error);
                });
        }
        
        /**
         * Panel butonuna tÄ±klandÄ±ÄŸÄ±nda Firestore Ã¼zerinden yÃ¶netici eriÅŸimini kontrol eder.
         */
        async function checkPanelAccess() {
            if (!isAuthReady || !db || !userId) {
                // Auth hazÄ±r deÄŸilse kullanÄ±cÄ±yÄ± beklet
                showAccessMessage("LÃ¼tfen bekleyin, kimlik doÄŸrulanÄ±yor...", false);
                return;
            }
            
            // YÃ–NETÄ°CÄ° KONTROL YOLU: /artifacts/{appId}/public/data/admins/{userId}
            const adminDocRef = doc(db, `artifacts/${appId}/public/data/admins`, userId);

            try {
                showAccessMessage("YÃ¶netici yetkisi kontrol ediliyor...", true); // ArtÄ±k otomatik yÃ¶netici olduÄŸunuz iÃ§in baÅŸarÄ±lÄ± mesajÄ± gÃ¶sterilebilir

                // Firestore'dan yÃ¶netici belgesini oku
                const adminDoc = await getDoc(adminDocRef);

                if (adminDoc.exists()) {
                    // YÃ¶netici doÄŸrulandÄ±
                    showAccessMessage("EriÅŸim OnaylandÄ±! Panele yÃ¶nlendiriliyor...", true);
                    setTimeout(() => {
                        window.location.href = 'panel.html';
                    }, 100); // YÃ¶nlendirme sÃ¼resi 100ms'ye dÃ¼ÅŸÃ¼rÃ¼ldÃ¼
                } else {
                    // YÃ¶netici deÄŸil (Bu durumda sadece otomatik atama baÅŸarÄ±sÄ±z olursa gÃ¶rÃ¼nÃ¼r)
                    showAccessMessage("EriÅŸim Reddedildi. Buraya sadece yÃ¶neticiler girebilir.", false);
                }
            } catch (error) {
                console.error("Firestore YÃ¶netici Kontrol HatasÄ±:", error);
                showAccessMessage("Bir veritabanÄ± hatasÄ± oluÅŸtu. Konsolu kontrol edin.", false);
            }
        }

        // Panel Butonunu JavaScript ile baÄŸlama
        document.addEventListener('DOMContentLoaded', () => {
            const panelButton = document.getElementById('panel-button');
            if (panelButton) {
                panelButton.addEventListener('click', checkPanelAccess);
            }
        });

    </script>
    
    <!-- YÃ–NETÄ°CÄ° ERÄ°ÅžÄ°M KONTROLÃœ (Mesaj Kutusu Fonksiyonu) -->
    <script>
        // SimÃ¼lasyon mesaj kutusu iÃ§in basit bir fonksiyon
        function showAccessMessage(message, isSuccess) {
            let toast = document.getElementById('panel-access-toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'panel-access-toast';
                // Konum: SAÄž ALT KÃ–ÅžE
                toast.style.cssText = `
                    position: fixed; 
                    bottom: 20px; 
                    right: 20px; 
                    transform: none; 
                    background-color: ${isSuccess ? 'rgba(67, 181, 129, 0.9)' : 'rgba(255, 0, 0, 0.9)'}; 
                    color: white; 
                    padding: 15px 25px; 
                    border-radius: 10px; 
                    z-index: 9999; 
                    box-shadow: 0 0 15px ${isSuccess ? 'rgba(67, 181, 129, 0.7)' : 'rgba(255, 0, 0, 0.7)'};
                    font-family: 'Poppins', sans-serif; 
                    font-size: 1.1em; 
                    font-weight: 600;
                    text-align: center; 
                    opacity: 0; 
                    transition: opacity 0.5s ease;
                `;
                document.body.appendChild(toast);
            }
            
            // EÄŸer baÅŸarÄ± mesajÄ± gelirse arka planÄ± yeÅŸil yap
            toast.style.backgroundColor = isSuccess ? 'rgba(67, 181, 129, 0.9)' : 'rgba(255, 0, 0, 0.9)';
            toast.style.boxShadow = `0 0 15px ${isSuccess ? 'rgba(67, 181, 129, 0.7)' : 'rgba(255, 0, 0, 0.7)'}`;
            
            toast.textContent = message;
            toast.style.opacity = 1;
            
            setTimeout(() => {
                toast.style.opacity = 0;
            }, 4000); 
        }
    </script>

</body>
</html>
